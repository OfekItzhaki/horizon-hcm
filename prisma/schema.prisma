generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model agenda_items {
  id          String   @id
  meeting_id  String
  title       String
  description String?
  order       Int
  created_at  DateTime @default(now())
  meetings    meetings @relation(fields: [meeting_id], references: [id], onDelete: Cascade)

  @@index([meeting_id])
}

model analytics_events {
  id         String   @id
  user_id    String?
  event_name String
  event_data Json?
  session_id String?
  ip_address String?
  user_agent String?
  created_at DateTime @default(now())

  @@index([event_name, created_at])
  @@index([session_id])
  @@index([user_id, created_at])
}

model announcement_comments {
  id              String        @id
  announcement_id String
  user_id         String
  comment         String
  created_at      DateTime      @default(now())
  announcements   announcements @relation(fields: [announcement_id], references: [id], onDelete: Cascade)

  @@index([announcement_id])
}

model announcement_reads {
  id              String        @id
  announcement_id String
  user_id         String
  read_at         DateTime      @default(now())
  announcements   announcements @relation(fields: [announcement_id], references: [id], onDelete: Cascade)

  @@unique([announcement_id, user_id])
  @@index([announcement_id])
}

model announcements {
  id                    String                  @id
  building_id           String
  title                 String
  content               String
  category              String
  is_urgent             Boolean                 @default(false)
  author_id             String
  deleted_at            DateTime?
  created_at            DateTime                @default(now())
  updated_at            DateTime
  announcement_comments announcement_comments[]
  announcement_reads    announcement_reads[]
  buildings             buildings               @relation(fields: [building_id], references: [id], onDelete: Cascade)

  @@index([building_id, created_at])
  @@index([category])
  @@index([is_urgent])
}

model apartment_owners {
  id              String        @id
  apartment_id    String
  user_id         String
  ownership_share Decimal?      @db.Decimal(5, 2)
  is_primary      Boolean       @default(false)
  created_at      DateTime      @default(now())
  apartments      apartments    @relation(fields: [apartment_id], references: [id], onDelete: Cascade)
  user_profiles   user_profiles @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([apartment_id, user_id])
  @@index([apartment_id])
  @@index([user_id])
}

model apartment_tenants {
  id            String        @id
  apartment_id  String
  user_id       String
  move_in_date  DateTime?
  move_out_date DateTime?
  is_active     Boolean       @default(true)
  created_at    DateTime      @default(now())
  apartments    apartments    @relation(fields: [apartment_id], references: [id], onDelete: Cascade)
  user_profiles user_profiles @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([apartment_id, is_active])
  @@index([user_id])
}

model apartments {
  id                   String                 @id
  building_id          String
  apartment_number     String
  area_sqm             Decimal?               @db.Decimal(10, 2)
  floor                Int?
  is_vacant            Boolean                @default(false)
  created_at           DateTime               @default(now())
  updated_at           DateTime
  apartment_owners     apartment_owners[]
  apartment_tenants    apartment_tenants[]
  buildings            buildings              @relation(fields: [building_id], references: [id], onDelete: Cascade)
  maintenance_requests maintenance_requests[]
  payments             payments[]

  @@unique([building_id, apartment_number])
  @@index([building_id])
}

model audit_logs {
  id            String   @id
  user_id       String?
  action        String
  resource_type String?
  resource_id   String?
  ip_address    String?
  user_agent    String?
  metadata      Json?
  created_at    DateTime @default(now())

  @@index([action])
  @@index([resource_type, resource_id])
  @@index([user_id, created_at])
}

model building_committee_members {
  id            String        @id
  building_id   String
  user_id       String
  role          String?
  created_at    DateTime      @default(now())
  buildings     buildings     @relation(fields: [building_id], references: [id], onDelete: Cascade)
  user_profiles user_profiles @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([building_id, user_id])
  @@index([building_id])
  @@index([user_id])
}

model buildings {
  id                         String                       @id
  name                       String?
  address_line               String
  city                       String?
  postal_code                String?
  num_units                  Int?
  public_garden_area_sqm     Decimal?                     @db.Decimal(10, 2)
  public_balcony_area_sqm    Decimal?                     @db.Decimal(10, 2)
  public_rooftop_area_sqm    Decimal?                     @db.Decimal(10, 2)
  num_parking_spaces         Int?
  num_elevators              Int?
  num_entrance_doors         Int?
  entrance_code              String?
  shelter_description        String?
  current_balance            Decimal                      @default(0) @db.Decimal(12, 2)
  is_active                  Boolean                      @default(true)
  created_at                 DateTime                     @default(now())
  updated_at                 DateTime
  announcements              announcements[]
  apartments                 apartments[]
  building_committee_members building_committee_members[]
  documents                  documents[]
  maintenance_requests       maintenance_requests[]
  meetings                   meetings[]
}

model device_fingerprints {
  id                String   @id
  user_id           String
  fingerprint_hash  String   @unique
  user_agent        String
  ip_address        String
  screen_resolution String?
  timezone          String?
  language          String?
  platform          String?
  is_trusted        Boolean  @default(false)
  last_seen_at      DateTime @default(now())
  created_at        DateTime @default(now())

  @@index([fingerprint_hash])
  @@index([is_trusted])
  @@index([user_id])
}

model documents {
  id                  String    @id
  building_id         String
  file_id             String
  title               String
  category            String
  access_level        String
  version             Int       @default(1)
  previous_version_id String?
  uploaded_by         String
  created_at          DateTime  @default(now())
  updated_at          DateTime
  buildings           buildings @relation(fields: [building_id], references: [id], onDelete: Cascade)

  @@index([access_level])
  @@index([building_id, category])
}

model feature_flag_assignments {
  id              String   @id
  feature_flag_id String
  user_id         String
  variant         String
  created_at      DateTime @default(now())

  @@unique([feature_flag_id, user_id])
  @@index([user_id])
}

model feature_flags {
  id          String   @id
  name        String   @unique
  description String?
  is_enabled  Boolean  @default(false)
  variants    Json?
  rules       Json?
  created_at  DateTime @default(now())
  updated_at  DateTime

  @@index([is_enabled])
  @@index([name])
}

model feature_usage {
  id           String   @id
  user_id      String?
  feature_name String
  usage_count  Int      @default(1)
  last_used_at DateTime @default(now())
  created_at   DateTime @default(now())

  @@unique([user_id, feature_name])
  @@index([feature_name])
  @@index([user_id, last_used_at])
}

model files {
  id          String    @id
  user_id     String
  filename    String
  storage_key String    @unique
  mime_type   String
  size_bytes  Int
  url         String?
  is_public   Boolean   @default(false)
  is_scanned  Boolean   @default(false)
  scan_result String?
  metadata    Json?
  expires_at  DateTime?
  created_at  DateTime  @default(now())
  updated_at  DateTime

  @@index([is_scanned])
  @@index([storage_key])
  @@index([user_id, created_at])
}

model maintenance_comments {
  id                     String               @id
  maintenance_request_id String
  user_id                String
  comment                String
  created_at             DateTime             @default(now())
  maintenance_requests   maintenance_requests @relation(fields: [maintenance_request_id], references: [id], onDelete: Cascade)

  @@index([maintenance_request_id])
}

model maintenance_photos {
  id                     String               @id
  maintenance_request_id String
  file_id                String
  created_at             DateTime             @default(now())
  maintenance_requests   maintenance_requests @relation(fields: [maintenance_request_id], references: [id], onDelete: Cascade)

  @@index([maintenance_request_id])
}

model maintenance_requests {
  id                   String                 @id
  building_id          String
  apartment_id         String?
  requester_id         String
  title                String
  description          String
  category             String
  priority             String
  status               String
  assigned_to          String?
  completion_date      DateTime?
  created_at           DateTime               @default(now())
  updated_at           DateTime
  maintenance_comments maintenance_comments[]
  maintenance_photos   maintenance_photos[]
  apartments           apartments?            @relation(fields: [apartment_id], references: [id])
  buildings            buildings              @relation(fields: [building_id], references: [id], onDelete: Cascade)

  @@index([apartment_id])
  @@index([building_id, status])
  @@index([priority])
  @@index([requester_id])
  @@index([status])
}

model meeting_attendees {
  id          String   @id
  meeting_id  String
  user_id     String
  rsvp_status String?
  attended    Boolean  @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime
  meetings    meetings @relation(fields: [meeting_id], references: [id], onDelete: Cascade)

  @@unique([meeting_id, user_id])
  @@index([meeting_id])
  @@index([user_id])
}

model meetings {
  id                String              @id
  building_id       String
  title             String
  description       String?
  meeting_date      DateTime
  location          String?
  is_recurring      Boolean             @default(false)
  recurrence_rule   String?
  status            String              @default("scheduled")
  created_by        String
  created_at        DateTime            @default(now())
  updated_at        DateTime
  agenda_items      agenda_items[]
  meeting_attendees meeting_attendees[]
  buildings         buildings           @relation(fields: [building_id], references: [id], onDelete: Cascade)
  votes             votes[]

  @@index([building_id, meeting_date])
  @@index([status])
}

model notification_logs {
  id              String    @id
  user_id         String
  template_name   String?
  title           String
  body            String
  delivery_status String
  provider        String
  error_message   String?
  sent_at         DateTime?
  delivered_at    DateTime?
  created_at      DateTime  @default(now())

  @@index([delivery_status])
  @@index([user_id, created_at])
}

model notification_preferences {
  id                    String   @id
  user_id               String   @unique
  payment_reminders     Boolean  @default(true)
  maintenance_alerts    Boolean  @default(true)
  meeting_notifications Boolean  @default(true)
  general_announcements Boolean  @default(true)
  push_enabled          Boolean  @default(true)
  email_enabled         Boolean  @default(true)
  created_at            DateTime @default(now())
  updated_at            DateTime

  @@index([user_id])
}

model notification_templates {
  id         String   @id
  name       String   @unique
  title      String
  body       String
  language   String   @default("en")
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime

  @@index([name, language])
}

model payments {
  id               String     @id
  apartment_id     String
  amount           Decimal    @db.Decimal(12, 2)
  due_date         DateTime
  paid_date        DateTime?
  status           String
  payment_type     String
  description      String?
  reference_number String?
  created_by       String
  created_at       DateTime   @default(now())
  updated_at       DateTime
  apartments       apartments @relation(fields: [apartment_id], references: [id], onDelete: Cascade)

  @@index([apartment_id, status])
  @@index([due_date])
  @@index([status])
}

model performance_metrics {
  id                   String   @id
  endpoint             String
  response_time_ms     Int
  database_queries     Int      @default(0)
  database_time_ms     Int      @default(0)
  cache_hits           Int      @default(0)
  cache_misses         Int      @default(0)
  external_api_calls   Int      @default(0)
  external_api_time_ms Int      @default(0)
  status_code          Int?
  error_message        String?
  created_at           DateTime @default(now())

  @@index([created_at])
  @@index([endpoint, created_at])
}

model sync_states {
  id                  String   @id
  user_id             String
  entity_type         String
  last_sync_timestamp DateTime @default(now())
  pending_operations  Int      @default(0)
  created_at          DateTime @default(now())
  updated_at          DateTime

  @@unique([user_id, entity_type])
  @@index([entity_type])
  @@index([user_id])
}

model translations {
  id         String   @id
  key        String
  language   String
  value      String
  namespace  String   @default("common")
  created_at DateTime @default(now())
  updated_at DateTime

  @@unique([key, language, namespace])
  @@index([language])
  @@index([namespace])
}

model user_profiles {
  id                         String                       @id
  user_id                    String                       @unique
  full_name                  String
  national_id                String?
  phone_number               String?
  user_type                  UserType
  preferred_language         String                       @default("en")
  signing_key                String?
  created_at                 DateTime                     @default(now())
  updated_at                 DateTime
  apartment_owners           apartment_owners[]
  apartment_tenants          apartment_tenants[]
  building_committee_members building_committee_members[]

  @@index([user_id])
}

model vote_records {
  id         String   @id
  vote_id    String
  user_id    String
  option     String
  created_at DateTime @default(now())
  votes      votes    @relation(fields: [vote_id], references: [id], onDelete: Cascade)

  @@unique([vote_id, user_id])
  @@index([vote_id])
}

model votes {
  id           String         @id
  meeting_id   String
  title        String
  description  String?
  options      Json
  created_at   DateTime       @default(now())
  closed_at    DateTime?
  vote_records vote_records[]
  meetings     meetings       @relation(fields: [meeting_id], references: [id], onDelete: Cascade)

  @@index([meeting_id])
}

model webhook_deliveries {
  id           String    @id
  webhook_id   String
  event_type   String
  payload      Json
  status       String
  attempts     Int       @default(0)
  response     String?
  error        String?
  delivered_at DateTime?
  created_at   DateTime  @default(now())
  webhooks     webhooks  @relation(fields: [webhook_id], references: [id], onDelete: Cascade)

  @@index([event_type])
  @@index([status])
  @@index([webhook_id, created_at])
}

model webhooks {
  id                 String               @id
  url                String
  events             String[]
  secret             String
  is_active          Boolean              @default(true)
  created_by         String
  created_at         DateTime             @default(now())
  updated_at         DateTime
  webhook_deliveries webhook_deliveries[]

  @@index([created_by])
  @@index([is_active])
}

enum UserType {
  COMMITTEE
  OWNER
  TENANT
  ADMIN
}
